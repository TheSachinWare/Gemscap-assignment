# Live Pairs Analytics (Binance Futures)

Small end-to-end demo that ingests Binance futures trades in real time, stores ticks, resamples to 1s/1m/5m, runs pairs analytics (hedge ratio via OLS, spread, z-score, ADF, rolling correlation), a tiny mean-reversion sanity backtest, and exposes everything via a Dash frontend with alerts, uploads, and exports.

## Quick start

1. Install dependencies (Python 3.10+):
   ```bash
   pip install -r requirements.txt
   ```
2. Run the app (single command):
   ```bash
   python app.py
   ```
3. Open http://localhost:8050. Press **Start** to begin streaming. Change symbols (comma-separated lowercase, e.g. `btcusdt,ethusdt`) and click **Start** again to restart streams.

## What’s inside

- **Backend ingestion**: `core/ingestion.py` spins up a background websocket client against `fstream.binance.com` combined streams and feeds a thread-safe `TickStore`.
- **State & storage**: `core/state.py` keeps a bounded in-memory buffer (default 50k ticks) with thread locks.
- **Analytics**: `core/analytics.py` provides resampling, OLS hedge ratio, spread/z-score, ADF test, rolling correlation, summary stats, and a micro mean-reversion backtest.
- **Alerts**: `core/alerts.py` supports simple metric rules; UI exposes a |z| threshold.
- **Frontend**: Dash + Bootstrap with navbar controls, collapsible sidebar + multi-view (Dashboard, Login, Signup, Alerts, Exports), KPI cards, zoomable charts, stats table, alert panel, login/signup, CSV upload, download of raw ticks, configurable windows, and a theme toggle (dark/light).
- **Architecture diagram**: `architecture.drawio` (source) and `architecture.png` (export generated by `tools/make_diagram.py`).
- **Transparency**: `CHATGPT_USAGE.md` describes where AI was used.

## Controls & behaviors

- **Timeframes**: choose tick, 1s, 1m, or 5m resample for plots.
- **Pair analytics**: pick two symbols for hedge ratio, spread, z-score, ADF p-value, and rolling correlation.
- **Alerts**: z-score absolute threshold; fired alerts appear in the alert box.
- **Uploads**: drop CSV with columns `ts,symbol,price,size` (ts parseable to datetime, UTC assumed). Uploaded rows are appended to the live buffer so offline work still functions.
- **Exports**: “Download CSV” returns the current buffered ticks.

## Design notes & trade-offs

- **Loose coupling**: ingestion thread writes into `TickStore`; Dash callbacks read snapshots and run analytics—no direct coupling to websockets.
- **Thread safety**: `TickStore` wraps a `deque` with locks to avoid races.
- **Resampling choice**: pandas `resample` per symbol; rolling windows operate on latest lookback to keep computations light.
- **Extensibility**: add analytics in `core/analytics.py` and surface via callbacks; swap data feeds by implementing another ingestor that writes to the same store.
- **Persistence**: kept in-memory for simplicity; swap `TickStore` with SQLite/Redis without touching the UI layer.
- **Error handling**: websocket loop retries with backoff; upload handler validates columns.

## Possible extensions

- Kalman-filter hedge ratio, robust regressions (Huber/Theil–Sen).
- Liquidity filters, cross-correlation heatmaps, term-structure views.
- Rich alert DSL (multi-metric, AND/OR) and webhook/email dispatch.
- Lightweight backtest module for entry/exit rules and PnL curves.
- Persist ticks to Parquet/SQLite and add historical replay.

## UI improvements (this update)

- Added a small visual polish layer via `assets/custom.css` to improve spacing, rounded cards, hero styling, and responsive tweaks.
- Transient toast notifications now appear when alert rules fire for clearer, less intrusive alerts.
- Minor layout and accessibility tweaks to make the dashboard cleaner on small screens.

Further UI upgrades in this pass:

- Added an SVG logo (`assets/logo.svg`) and improved navbar layout for better brand presence.
- Improved KPI area with compact sparklines for each active symbol so you can glance at short-term trends.
- Wrapped charts in `dbc.Spinner` so users see a loading indicator when plots are being recomputed.
- Uploads now trigger a transient toast for immediate feedback (friendly confirmation).
- Included the Inter font (via Google Fonts) for a cleaner, modern typographic look.


## Testing

No formal test suite is included (timeboxed). The analytics functions are small and can be unit-tested independently (e.g., feed synthetic random walks, assert hedge ratio sign and z-score behavior). The ingestion loop can be smoke-tested with a recorded NDJSON file by adapting the upload path.

## Docker (optional)

Build and run the app in a container (recommended for reproducible environments):

```bash
docker build -t live-pairs-analytics:latest .
docker run -p 8050:8050 --rm live-pairs-analytics:latest
```

The `Dockerfile` bundles the app and installs dependencies listed in `requirements.txt`. For production, run the app behind a proper WSGI server and add a persistent store for ticks.

See [ARCHITECTURE.md](ARCHITECTURE.md) for design choices, trade-offs, and next steps.

